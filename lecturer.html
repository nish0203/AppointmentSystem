<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lecturer Dashboard â€“ Uni Bookings</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <style>
    /* == Reset & Base == */
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body { font-family: Arial, sans-serif; background: #f9fafb; color: #333 }

    /* == Header & Nav == */
    header {
      background: white; color: black;
      padding: 12px 32px;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid #ccc;
    }
    .left-header { display: flex; align-items: center; gap: 24px }
    .logo img { height: 60px }
    .menu-links a { color: black; font-weight: 500; margin-right: 16px }
    .top-nav a { color: black; font-weight: 500 }

    /* == Main == */
    .container { padding: 24px }
    h1 { font-size: 1.5rem; margin-bottom: .5rem }
    h2 { margin-bottom: 16px }

    /* == Card & Collapsible == */
    .card { background: #fff; border: 1px solid #ddd; border-radius: 8px;
            margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: hidden; transition: max-height .5s ease }
    .collapsible h3 {
      padding: 16px; cursor: pointer; display: flex;
      justify-content: space-between; align-items: center;
      background: #f1f5f9; margin: 0;
    }
    .content {
      max-height: 0; padding: 0 16px; transition: max-height .5s ease, padding .5s ease;
    }
    .active .content {
      max-height: 500px; padding: 16px;
    }
    .arrow { transition: transform .3s }
    .active .arrow { transform: rotate(180deg) }

    /* == Form Elements == */
    input {
      padding: 8px; margin-right: 8px;
      border: 1px solid #ccc; border-radius: 4px;
    }
    button {
      padding: 8px 16px; border: none; border-radius: 4px;
      cursor: pointer;
    }
    #add-slot-btn { background: #1E3A8A; color: white }
    #save-availability-btn { background: #10B981; color: white; margin-top: 12px }

    ul { list-style: none; margin-top: 12px }
    ul li { margin-bottom: 8px }
    ul li button {
      margin-left: 8px; background: none;
      border: 1px solid #e53e3e; color: #e53e3e; border-radius: 4px;
    }

        #slot-management .content {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    #slot-management .content p {
      font-size: 1rem;
      color: #444;
    }
    #slot-management input {
      padding: .6rem;
      border: 1px solid #bbb;
      border-radius: 6px;
      width: 100%;
      max-width: 240px;
    }
    #slot-management button {
      padding: .6rem 1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background .2s;
    }
    #add-slot-btn {
      background: #1E3A8A;
      color: white;
    }
    #add-slot-btn:hover {
      background: #162A66;
    }
    #save-availability-btn {
      background: #10B981;
      color: white;
      align-self: flex-start;
    }
    #save-availability-btn:hover {
      background: #0E9F75;
    }
    #slots-list {
      list-style: none;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
      gap: .75rem;
      margin: 0;
    }
    #slots-list li {
      background: #f1f5f9;
      border: 1px solid #dde4eb;
      border-radius: 8px;
      padding: .75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #slots-list li span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-right: .5rem;
      font-size: .95rem;
      color: #333;
    }
    #slots-list li button {
      background: transparent;
      border: none;
      color: #ef4444;
      font-size: .9rem;
      cursor: pointer;
      padding: .2rem .4rem;
      border-radius: 4px;
      transition: background .2s;
    }
    #slots-list li button:hover {
      background: rgba(239,68,68, .1);
    }
  </style>
</head>


<body>
  <header>
    <div class="left-header">
      <div class="logo"><img src="eBbook2.png" style="height: 60px;"></div>
      <nav class="menu-links">
        <a href="upcoming.html">Upcoming Appointments</a>
        <a href="inquirylect.html">Submit Inquiry</a>
      </nav>
    </div>
    <nav class="top-nav">
      <a id="logout-link" href="login.html">Logout</a>
    </nav>
  </header>

 <main class="container">
    <h1>Hi, <span id="user-name">â€¦</span>ðŸ‘‹!</h1>
    <h2>Lecturer Dashboard</h2>

    <div id="slot-management" class="card collapsible">
      <h3>Set Appointment Slots <span class="arrow">&#9662;</span></h3>
      <div class="content">
        <p>Select a date, then add one or more time-slots:</p>
        <div style="display:flex; gap:1rem; flex-wrap:wrap;">
          <input type="text" id="availability-date" placeholder="Select date">
          <input type="text" id="start-time-input"  placeholder="Start time">
          <input type="text" id="end-time-input"    placeholder="End time">
          <button id="add-slot-btn">Add Slot</button>
        </div>
        <ul id="slots-list"><!-- slots go here --></ul>
        <button id="save-availability-btn">Save Availability</button>
      </div>
    </div>
  </main>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getFirestore, doc, getDoc, setDoc,
      collection, getDocs
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
    import { getAuth }      from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";

    // â”€â”€â”€ Firebase init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const firebaseConfig = {
      apiKey: "AIzaSyD3TSVMe8Ub-JL0y7M0VlXvPdskeOG1DaA",
      authDomain: "appointment-management-c2531.firebaseapp.com",
      projectId: "appointment-management-c2531",
      storageBucket: "appointment-management-c2531.appspot.com",
      messagingSenderId: "428786083628",
      appId: "1:428786083628:web:d9d9576b12581cc697ee89",
      measurementId: "G-9FM8F1WJMF"
    };
    const app  = initializeApp(firebaseConfig);
    const db   = getFirestore(app);
    getAuth(app);
    getAnalytics(app);

    document.addEventListener('DOMContentLoaded', () => {
      // 1) Collapsible panels
      document.querySelectorAll('.collapsible h3').forEach(h3 => {
        h3.addEventListener('click', () => {
          h3.parentElement.classList.toggle('active');
        });
      });

      // 2) Flatpickr
      flatpickr("#availability-date",   { inline:true, minDate:"today", dateFormat:"Y-m-d" });
      flatpickr("#start-time-input",    { enableTime:true, noCalendar:true, dateFormat:"h:i K" });
      flatpickr("#end-time-input",      { enableTime:true, noCalendar:true, dateFormat:"h:i K" });

      // 3) Add-slot button
      const slotsList     = document.getElementById('slots-list');
      document.getElementById('add-slot-btn').addEventListener('click', () => {
        const date  = document.getElementById('availability-date').value;
        const start = document.getElementById('start-time-input').value;
        const end   = document.getElementById('end-time-input').value;
        if(!date||!start||!end) return alert('Select date & times.');
        if(flatpickr.parseDate(start,"h:i K") >= flatpickr.parseDate(end,"h:i K"))
          return alert('End must be after start.');
        const li = document.createElement('li');
        li.textContent = `${date} ${start} â€“ ${end}`;
        const btn = document.createElement('button');
        btn.textContent = 'Remove';
        btn.onclick = ()=>li.remove();
        li.append(btn);
        slotsList.append(li);
      });

      // 4) Save-availability
      document.getElementById('save-availability-btn').addEventListener('click', async () => {
        const date  = document.getElementById('availability-date').value;
        const email = sessionStorage.getItem('userEmail');
        const times = Array.from(slotsList.children)
                           .map(li => li.firstChild.textContent);
        if(!date||!times.length) return alert('Add at least one slot.');
        try {
          await setDoc(doc(db,'lecturers',email,'availability',date),{slots:times});
          alert('Availability saved!');
        } catch(e) {
          console.error(e);
          alert('Save failed.');
        }
      });

      // 5) Load & render slots on refresh
      (async ()=>{
        const email = sessionStorage.getItem('userEmail');
        if (!email) return;
        const snap = await getDocs(collection(db,'lecturers',email,'availability'));
        snap.forEach(docSnap => {
          const { slots } = docSnap.data();
          slots.forEach(entry=>{
            const li = document.createElement('li');
            li.textContent = entry;
            const btn = document.createElement('button');
            btn.textContent = 'Remove';
            btn.onclick = ()=>li.remove();
            li.append(btn);
            slotsList.append(li);
          });
        });
      })();

      // 6) Name detection + sessionStorage
      (async ()=>{
        const params    = new URLSearchParams(location.search);
        const email     = params.get('email')||sessionStorage.getItem('userEmail');
        const nameEl    = document.getElementById('user-name');
        if (email) {
          const snap = await getDoc(doc(db,'lecturers',email));
          const profile = snap.exists()?snap.data():{};
          const name    = profile.name||'Lecturer';
          nameEl.textContent = name;
          sessionStorage.setItem('userEmail',email);
          sessionStorage.setItem('userName',name);
        } else {
          nameEl.textContent = sessionStorage.getItem('userName')||'Lecturer';
        }
        document.getElementById('logout-link')
                .addEventListener('click',()=>sessionStorage.clear());
      })();
    });
  </script>
</body>
</html>